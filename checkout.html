<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LITESTORE ‚Äî Owner Panel</title>
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #111;
            color: #fff;
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ‚îÄ AUTH GATE ‚îÄ‚îÄ‚îÄ */
        #auth-gate {
            position: fixed;
            inset: 0;
            background: #111;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .gate-card {
            text-align: center;
            padding: 48px;
        }
        .gate-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        .gate-title {
            font-size: 18px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #ef4444;
            margin-bottom: 10px;
        }
        .gate-sub {
            font-size: 13px;
            color: #555;
        }
        #loading-gate {
            position: fixed;
            inset: 0;
            background: #111;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9998;
            flex-direction: column;
            gap: 16px;
        }
        .spinner {
            width: 36px;
            height: 36px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
        #app { display: none; }

        .sidebar {
            position: fixed;
            left: 0; top: 0;
            width: 260px;
            height: 100vh;
            background: rgba(10,10,10,0.98);
            border-right: 1px solid rgba(255,255,255,0.07);
            display: flex;
            flex-direction: column;
            z-index: 100;
            border-radius: 0 24px 24px 0;
        }
        .sidebar-logo {
            padding: 28px 24px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.07);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo-icon {
            width: 36px; height: 36px;
            background: #fff;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .logo-icon svg { width: 20px; height: 20px; fill: #000; }
        .logo-text { font-size: 16px; font-weight: 800; letter-spacing: 2px; }
        .logo-badge {
            font-size: 8px;
            letter-spacing: 1.5px;
            color: #ef4444;
            background: rgba(239,68,68,0.1);
            border: 1px solid rgba(239,68,68,0.2);
            padding: 3px 8px;
            border-radius: 6px;
            margin-left: auto;
            font-weight: 700;
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow-y: auto;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: #555;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }
        .nav-item svg { width: 16px; height: 16px; fill: currentColor; flex-shrink: 0; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #aaa; }
        .nav-item.active { background: rgba(255,255,255,0.08); color: #fff; }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid rgba(255,255,255,0.07);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .owner-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            background: rgba(255,255,255,0.03);
        }
        .owner-avatar {
            width: 32px; height: 32px;
            background: #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px;
            color: #000;
            font-weight: 800;
            flex-shrink: 0;
        }
        .owner-name { font-size: 11px; font-weight: 700; }
        .owner-role { font-size: 9px; color: #ef4444; letter-spacing: 1px; font-weight: 700; }
        .btn-logout {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: rgba(239,68,68,0.08);
            border: 1px solid rgba(239,68,68,0.15);
            border-radius: 10px;
            color: #ef4444;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1.5px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            width: 100%;
        }
        .btn-logout svg { width: 14px; height: 14px; fill: currentColor; }
        .btn-logout:hover { background: rgba(239,68,68,0.15); }

        /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
        .main {
            margin-left: 260px;
            padding: 36px 40px;
            min-height: 100vh;
        }
        .page { display: none; }
        .page.active { display: block; }

        .page-header {
            margin-bottom: 36px;
        }
        .page-label {
            font-size: 10px;
            letter-spacing: 3px;
            color: #555;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .page-title {
            font-size: 36px;
            font-weight: 900;
            letter-spacing: -1px;
        }

        /* ‚îÄ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ‚îÄ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }
        .stat-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        .stat-card:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0; left: 12%; right: 12%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
        }
        .stat-icon {
            width: 40px; height: 40px;
            background: rgba(255,255,255,0.07);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 16px;
        }
        .stat-icon svg { width: 20px; height: 20px; fill: #fff; }
        .stat-icon.green { background: rgba(34,197,94,0.1); }
        .stat-icon.green svg { fill: #22c55e; }
        .stat-icon.blue { background: rgba(59,130,246,0.1); }
        .stat-icon.blue svg { fill: #3b82f6; }
        .stat-icon.orange { background: rgba(249,115,22,0.1); }
        .stat-icon.orange svg { fill: #f97316; }
        .stat-label {
            font-size: 9px;
            letter-spacing: 2.5px;
            color: #555;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -1px;
            margin-bottom: 4px;
        }
        .stat-sub {
            font-size: 11px;
            color: #555;
        }
        .stat-sub.up { color: #22c55e; }
        .stat-sub.down { color: #ef4444; }

        /* ‚îÄ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ‚îÄ */
        .charts-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }
        .chart-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 28px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }
        .chart-title {
            font-size: 14px;
            font-weight: 800;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .chart-sub {
            font-size: 11px;
            color: #555;
        }
        .chart-period {
            display: flex;
            gap: 6px;
        }
        .period-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
        }
        .period-btn.active {
            background: #fff;
            color: #000;
            border-color: #fff;
        }
        .chart-wrap { position: relative; height: 200px; }

        /* ‚îÄ‚îÄ‚îÄ ORDERS TABLE ‚îÄ‚îÄ‚îÄ */
        .table-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 32px;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .table-title { font-size: 14px; font-weight: 800; }
        .badge {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .badge-pending { background: rgba(249,115,22,0.15); color: #f97316; }
        .badge-delivered { background: rgba(34,197,94,0.1); color: #22c55e; }
        .badge-neutral { background: rgba(255,255,255,0.07); color: #888; }

        table { width: 100%; border-collapse: collapse; }
        th {
            text-align: left;
            font-size: 9px;
            letter-spacing: 2px;
            color: #444;
            text-transform: uppercase;
            padding: 0 16px 16px;
            font-weight: 700;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        td {
            padding: 16px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            vertical-align: middle;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .user-cell { display: flex; align-items: center; gap: 10px; }
        .user-avatar-sm {
            width: 28px; height: 28px;
            background: rgba(255,255,255,0.08);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }
        .product-cell { display: flex; align-items: center; gap: 8px; }
        .product-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .dot-robux { background: #a855f7; }
        .dot-gta { background: #3b82f6; }

        /* ‚îÄ‚îÄ‚îÄ TOP PRODUCTS ‚îÄ‚îÄ‚îÄ */
        .products-list { display: flex; flex-direction: column; gap: 12px; }
        .product-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .product-rank {
            font-size: 11px;
            color: #444;
            font-weight: 700;
            width: 20px;
        }
        .product-info { flex: 1; }
        .product-name-sm { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
        .product-bar-wrap {
            height: 4px;
            background: rgba(255,255,255,0.06);
            border-radius: 2px;
            overflow: hidden;
        }
        .product-bar {
            height: 100%;
            border-radius: 2px;
            background: linear-gradient(90deg, rgba(255,255,255,0.3), rgba(255,255,255,0.6));
        }
        .product-count { font-size: 12px; color: #888; font-weight: 700; }

        /* ‚îÄ‚îÄ‚îÄ VISITS PAGE ‚îÄ‚îÄ‚îÄ */
        .visits-info {
            background: rgba(59,130,246,0.08);
            border: 1px solid rgba(59,130,246,0.15);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        .visits-info svg { width: 18px; height: 18px; fill: #3b82f6; flex-shrink: 0; margin-top: 1px; }
        .visits-info p { font-size: 13px; color: #888; line-height: 1.6; }
        .visits-info strong { color: #fff; }

        /* ‚îÄ‚îÄ‚îÄ ADD ORDER FORM ‚îÄ‚îÄ‚îÄ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group.full { grid-column: 1 / -1; }
        .form-label {
            font-size: 10px;
            letter-spacing: 2px;
            color: #555;
            text-transform: uppercase;
            font-weight: 700;
        }
        .form-input, .form-select {
            padding: 14px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            color: #fff;
            font-size: 14px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s;
        }
        .form-input:focus, .form-select:focus {
            border-color: rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.08);
        }
        .form-input::placeholder { color: #333; }
        .form-select option { background: #1a1a1a; }
        .btn-submit {
            padding: 16px 32px;
            background: #fff;
            color: #000;
            border: none;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .btn-submit:hover { background: #f0f0f0; transform: translateY(-1px); }
        .form-success {
            display: none;
            padding: 14px 18px;
            background: rgba(34,197,94,0.1);
            border: 1px solid rgba(34,197,94,0.2);
            border-radius: 12px;
            font-size: 13px;
            color: #22c55e;
            margin-top: 12px;
        }

        /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-row { grid-template-columns: 1fr; }
        }
        @media (max-width: 900px) {
            .sidebar { width: 220px; }
            .main { margin-left: 220px; padding: 24px 20px; }
        }
        @media (max-width: 700px) {
            .sidebar {
                position: fixed;
                bottom: 0; left: 0; right: 0;
                width: 100%;
                height: auto;
                flex-direction: row;
                border-radius: 20px 20px 0 0;
                border-right: none;
                border-top: 1px solid rgba(255,255,255,0.07);
            }
            .sidebar-logo, .sidebar-footer { display: none; }
            .sidebar-nav {
                flex-direction: row;
                padding: 12px;
                gap: 4px;
                justify-content: space-around;
                width: 100%;
                overflow-x: auto;
            }
            .nav-item { flex-direction: column; gap: 4px; padding: 8px 12px; font-size: 8px; }
            .nav-item svg { width: 20px; height: 20px; }
            .main { margin-left: 0; padding: 20px 16px 100px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .stat-value { font-size: 24px; }
            .page-title { font-size: 26px; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- Loading -->
<div id="loading-gate">
    <div class="spinner"></div>
    <div style="font-size:11px;letter-spacing:2px;color:#444;">WERYFIKACJA...</div>
</div>

<!-- Access Denied -->
<div id="auth-gate" style="display:none;">
    <div class="gate-card">
        <div class="gate-icon">üîí</div>
        <div class="gate-title">BRAK DOSTƒòPU</div>
        <div class="gate-sub" style="margin-bottom:24px;">Ten panel jest tylko dla w≈Ça≈õciciela.</div>
        <a href="index.html" style="color:#fff;font-size:12px;letter-spacing:1px;">‚Üê Wr√≥ƒá do sklepu</a>
    </div>
</div>

<!-- App -->
<div id="app">
    <!-- Sta≈Çy przycisk powrotu - prawy g√≥rny r√≥g -->
    <a href="index.html" style="
        position: fixed;
        top: 24px;
        right: 32px;
        z-index: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 14px;
        color: #888;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        text-decoration: none;
        transition: all 0.2s;
        backdrop-filter: blur(10px);
    " onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='#fff';this.style.borderColor='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.05)';this.style.color='#888';this.style.borderColor='rgba(255,255,255,0.1)'">
        <svg viewBox="0 0 24 24" style="width:15px;height:15px;fill:currentColor;flex-shrink:0;">
            <path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/>
        </svg>
        Sklep
    </a>
    <!-- Sidebar -->
    <div class="sidebar">
        <a href="index.html" class="sidebar-logo" style="text-decoration:none;color:inherit;">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24"><path d="M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18L20 8.5v.01L12 13 4 8.51 12 4.18zM4 10.18l8 4.5v6.14L4 16.32V10.18zm10 10.64v-6.14l8-4.5v6.14l-8 4.5z"/></svg>
            </div>
            <span class="logo-text">LITESTORE</span>
            <span class="logo-badge">OWNER</span>
        </a>

        <nav class="sidebar-nav">
            <button class="nav-item active" onclick="showPage('overview')">
                <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                PrzeglƒÖd
            </button>
            <button class="nav-item" onclick="showPage('orders')">
                <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                Zam√≥wienia
            </button>
            <button class="nav-item" onclick="showPage('customers')">
                <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                Klienci
            </button>
            <button class="nav-item" onclick="showPage('visits')">
                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                Wej≈õcia
            </button>
            <button class="nav-item" onclick="showPage('add-order')">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                Dodaj zam√≥wienie
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="owner-info">
                <div class="owner-avatar">T</div>
                <div>
                    <div class="owner-name">Tymoteusz</div>
                    <div class="owner-role">W≈ÅA≈öCICIEL</div>
                </div>
            </div>
            <a href="index.html" style="
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 12px 14px;
                background: rgba(255,255,255,0.05);
                border: 1px solid rgba(255,255,255,0.08);
                border-radius: 10px;
                color: #888;
                font-size: 10px;
                font-weight: 700;
                letter-spacing: 1.5px;
                text-transform: uppercase;
                text-decoration: none;
                transition: all 0.2s;
            " onmouseover="this.style.background='rgba(255,255,255,0.09)';this.style.color='#fff'" onmouseout="this.style.background='rgba(255,255,255,0.05)';this.style.color='#888'">
                <svg viewBox="0 0 24 24" style="width:14px;height:14px;fill:currentColor;flex-shrink:0;">
                    <path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/>
                </svg>
                Wr√≥ƒá do sklepu
            </a>
            <button class="btn-logout" id="logoutBtn">
                <svg viewBox="0 0 24 24"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
                Wyloguj siƒô
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">

        <!-- OVERVIEW PAGE -->
        <div class="page active" id="page-overview">
            <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between;gap:20px;">
                <div>
                    <div class="page-label">PANEL W≈ÅA≈öCICIELA</div>
                    <div class="page-title">PrzeglƒÖd sklepu</div>
                </div>
                <a href="index.html" style="
                    display:flex;align-items:center;gap:8px;
                    padding:12px 20px;flex-shrink:0;
                    background:rgba(255,255,255,0.05);
                    border:1px solid rgba(255,255,255,0.1);
                    border-radius:14px;color:#888;
                    font-size:11px;font-weight:700;letter-spacing:1.5px;
                    text-transform:uppercase;text-decoration:none;transition:all 0.2s;
                " onmouseover="this.style.background='rgba(255,255,255,0.1)';this.style.color='#fff'" onmouseout="this.style.background='rgba(255,255,255,0.05)';this.style.color='#888'">
                    <svg viewBox="0 0 24 24" style="width:15px;height:15px;fill:currentColor;">
                        <path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/>
                    </svg>
                    Sklep
                </a>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                    </div>
                    <div class="stat-label">Przych√≥d ca≈Çkowity</div>
                    <div class="stat-value" id="stat-revenue">‚Äî</div>
                    <div class="stat-sub" id="stat-revenue-sub">≈Çadowanie...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                    </div>
                    <div class="stat-label">Klienci</div>
                    <div class="stat-value" id="stat-customers">‚Äî</div>
                    <div class="stat-sub" id="stat-customers-sub">≈Çadowanie...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    </div>
                    <div class="stat-label">Zam√≥wienia og√≥≈Çem</div>
                    <div class="stat-value" id="stat-orders-total">‚Äî</div>
                    <div class="stat-sub" id="stat-orders-pending"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                    </div>
                    <div class="stat-label">Wej≈õcia na stronƒô</div>
                    <div class="stat-value" id="stat-visits">‚Äî</div>
                    <div class="stat-sub" id="stat-visits-sub">≈ÇƒÖcznie</div>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Przychody</div>
                            <div class="chart-sub">Zarobki w ostatnich miesiƒÖcach</div>
                        </div>
                    </div>
                    <div class="chart-wrap">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Top produkty</div>
                            <div class="chart-sub">Ilo≈õƒá sprzedanych sztuk</div>
                        </div>
                    </div>
                    <div class="products-list" id="topProductsList">
                        <div style="color:#444;font-size:12px;text-align:center;padding:20px;">≈Åadowanie...</div>
                    </div>
                </div>
            </div>

            <div class="charts-row" style="grid-template-columns: 1fr 1fr;">
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Zam√≥wienia (ostatnie 7 dni)</div>
                            <div class="chart-sub">Liczba zam√≥wie≈Ñ dziennie</div>
                        </div>
                    </div>
                    <div class="chart-wrap">
                        <canvas id="ordersChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Podzia≈Ç produkt√≥w</div>
                            <div class="chart-sub">Robux vs GTA$</div>
                        </div>
                    </div>
                    <div class="chart-wrap" style="display:flex;align-items:center;justify-content:center;">
                        <canvas id="pieChart" style="max-height:180px;max-width:180px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ORDERS PAGE -->
        <div class="page" id="page-orders">
            <div class="page-header">
                <div class="page-label">ZARZƒÑDZANIE</div>
                <div class="page-title">Zam√≥wienia</div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">Wszystkie zam√≥wienia</div>
                    <span class="badge badge-neutral" id="orders-count-badge">0 zam√≥wie≈Ñ</span>
                </div>
                <div style="overflow-x:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Klient</th>
                                <th>Produkt</th>
                                <th>Kwota</th>
                                <th>Data</th>
                                <th>Gamepass</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <tr><td colspan="5" style="text-align:center;color:#444;padding:40px;">≈Åadowanie...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- CUSTOMERS PAGE -->
        <div class="page" id="page-customers">
            <div class="page-header">
                <div class="page-label">BAZA DANYCH</div>
                <div class="page-title">Klienci</div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <div class="table-title">Zarejestrowani u≈ºytkownicy</div>
                    <span class="badge badge-neutral" id="customers-count-badge">0 klient√≥w</span>
                </div>
                <div style="overflow-x:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>U≈ºytkownik</th>
                                <th>E-mail</th>
                                <th>Nick</th>
                                <th>Zam√≥wienia</th>
                                <th>Wyda≈Ç</th>
                            </tr>
                        </thead>
                        <tbody id="customers-table-body">
                            <tr><td colspan="5" style="text-align:center;color:#444;padding:40px;">≈Åadowanie...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VISITS PAGE -->
        <div class="page" id="page-visits">
            <div class="page-header">
                <div class="page-label">ANALITYKA</div>
                <div class="page-title">Wej≈õcia na stronƒô</div>
            </div>
            <div class="visits-info">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                <p>Licznik wej≈õƒá jest zliczany przez Firebase przy ka≈ºdej wizycie na stronie g≈Ç√≥wnej. Wymaga dodania <strong>skryptu trackujƒÖcego</strong> do <code>index.html</code> ‚Äî instrukcja poni≈ºej.</p>
            </div>
            <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="stat-card">
                    <div class="stat-label">≈ÅƒÖczne wej≈õcia</div>
                    <div class="stat-value" id="visit-total">‚Äî</div>
                    <div class="stat-sub">od poczƒÖtku</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Dzi≈õ</div>
                    <div class="stat-value" id="visit-today">‚Äî</div>
                    <div class="stat-sub" id="visit-today-date">‚Äî</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ostatnie 7 dni</div>
                    <div class="stat-value" id="visit-week">‚Äî</div>
                    <div class="stat-sub">wej≈õƒá</div>
                </div>
            </div>
            <div class="chart-card" style="margin-top:20px;">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Wej≈õcia ‚Äî ostatnie 14 dni</div>
                        <div class="chart-sub">Unikalne sesje dziennie</div>
                    </div>
                </div>
                <div class="chart-wrap">
                    <canvas id="visitsChart"></canvas>
                </div>
            </div>
            <div class="table-card" style="margin-top:20px;">
                <div class="table-title" style="margin-bottom:16px;">Jak dodaƒá ≈õledzenie wej≈õƒá?</div>
                <p style="font-size:13px;color:#666;line-height:1.7;">Dodaj ten kod do <code style="color:#aaa;">index.html</code> tu≈º przed <code style="color:#aaa;">&lt;/body&gt;</code>:</p>
                <pre style="margin-top:14px;padding:18px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);border-radius:12px;font-size:12px;color:#aaa;overflow-x:auto;line-height:1.8;">&lt;script type="module"&gt;
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, increment, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const app = initializeApp({ /* tw√≥j firebaseConfig */ });
  const db = getFirestore(app);
  const today = new Date().toISOString().split('T')[0];

  // ≈ÅƒÖczne wej≈õcia
  await setDoc(doc(db,'analytics','visits'), { total: increment(1) }, { merge: true });
  // Dzienne
  await setDoc(doc(db,'analytics','daily'), { [today]: increment(1) }, { merge: true });
&lt;/script&gt;</pre>
            </div>
        </div>

        <!-- ADD ORDER PAGE -->
        <div class="page" id="page-add-order">
            <div class="page-header">
                <div class="page-label">ZARZƒÑDZANIE</div>
                <div class="page-title">Dodaj zam√≥wienie</div>
            </div>
            <div class="table-card">
                <div class="table-title" style="margin-bottom:24px;">Nowe zam√≥wienie klienta</div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Email klienta</label>
                        <input class="form-input" id="fo-email" type="email" placeholder="klient@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nick klienta</label>
                        <input class="form-input" id="fo-nick" type="text" placeholder="nick w grze">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Produkt</label>
                        <select class="form-select" id="fo-product">
                            <option value="10M GTA$|gta|39">10M GTA$ ‚Äî 39 z≈Ç</option>
                            <option value="50M GTA$|gta|99">50M GTA$ ‚Äî 99 z≈Ç</option>
                            <option value="200M GTA$|gta|279">200M GTA$ ‚Äî 279 z≈Ç</option>
                            <option value="300 ROBUX|robux|10">300 ROBUX ‚Äî 10 z≈Ç</option>
                            <option value="1 000 ROBUX|robux|33">1 000 ROBUX ‚Äî 33 z≈Ç</option>
                            <option value="3 500 ROBUX|robux|116">3 500 ROBUX ‚Äî 116 z≈Ç</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="fo-status">
                            <option value="pending">W realizacji</option>
                            <option value="delivered">Dostarczono</option>
                        </select>
                    </div>
                    <div class="form-group full">
                        <label class="form-label">Notatka (opcjonalnie)</label>
                        <input class="form-input" id="fo-note" type="text" placeholder="np. zap≈Çaci≈Ç przez BLIK">
                    </div>
                </div>
                <button class="btn-submit" id="addOrderBtn">DODAJ ZAM√ìWIENIE</button>
                <div class="form-success" id="form-success">‚úì Zam√≥wienie zosta≈Ço dodane do Firebase!</div>
            </div>
        </div>

    </main>
</div>

<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import {
        getFirestore,
        collection, getDocs, addDoc,
        doc, setDoc, getDoc, updateDoc, arrayUnion,
        increment, serverTimestamp, query, orderBy, limit
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const OWNER_EMAIL = "plackowypotworhwdp2137@gmail.com";

    const firebaseConfig = {
        apiKey: "AIzaSyDD3Z98au_WMwaawKi3lFJsycC0GCdW0jQ",
        authDomain: "lajciorstore.firebaseapp.com",
        projectId: "lajciorstore",
        storageBucket: "lajciorstore.firebasestorage.app",
        messagingSenderId: "7091718515313",
        appId: "1:7091718515313:web:87fdad9a266aa88edd320e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ‚îÄ‚îÄ Auth gate ‚îÄ‚îÄ
    onAuthStateChanged(auth, async (user) => {
        document.getElementById('loading-gate').style.display = 'none';

        if (!user || user.email !== OWNER_EMAIL) {
            document.getElementById('auth-gate').style.display = 'flex';
            return;
        }

        document.getElementById('app').style.display = 'block';
        await loadAll();
    });

    // ‚îÄ‚îÄ Logout ‚îÄ‚îÄ
    document.getElementById('logoutBtn').onclick = () => {
        signOut(auth).then(() => window.location.href = 'login.html');
    };

    // ‚îÄ‚îÄ Page switcher ‚îÄ‚îÄ
    window.showPage = (name) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('page-' + name).classList.add('active');
        event.currentTarget.classList.add('active');
    };

    // ‚îÄ‚îÄ Load all data ‚îÄ‚îÄ
    async function loadAll() {
        const [ordersSnap, usersSnap, analyticsSnap, dailySnap] = await Promise.all([
            getDocs(collection(db, 'orders')),
            getDocs(collection(db, 'users')),
            getDoc(doc(db, 'analytics', 'visits')),
            getDoc(doc(db, 'analytics', 'daily')),
        ]);

        const orders = ordersSnap.docs.map(d => ({ id: d.id, ...d.data() }));
        const users  = usersSnap.docs.map(d => ({ id: d.id, ...d.data() }));

        renderStats(orders, users, analyticsSnap, dailySnap);
        renderCharts(orders, dailySnap);
        renderOrdersTable(orders, users);
        renderCustomersTable(users, orders);
        renderVisits(analyticsSnap, dailySnap);
        renderTopProducts(orders);
    }

    // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ
    function renderStats(orders, users, analyticsSnap, dailySnap) {
        const totalRevenue = orders.reduce((s, o) => s + (o.price || 0), 0);
        const pending = orders.filter(o => o.status === 'pending').length;
        const totalVisits = analyticsSnap.exists() ? (analyticsSnap.data().total || 0) : 0;

        document.getElementById('stat-revenue').textContent = totalRevenue.toFixed(0) + ' z≈Ç';
        document.getElementById('stat-revenue-sub').textContent = orders.length + ' transakcji';
        document.getElementById('stat-customers').textContent = users.length;
        document.getElementById('stat-customers-sub').textContent = 'zarejestrowanych';
        document.getElementById('stat-orders-total').textContent = orders.length;
        document.getElementById('stat-orders-pending').textContent = pending > 0 ? `‚ö† ${pending} w realizacji` : '‚úì brak oczekujƒÖcych';
        document.getElementById('stat-orders-pending').className = 'stat-sub ' + (pending > 0 ? 'down' : 'up');
        document.getElementById('stat-visits').textContent = totalVisits.toLocaleString('pl');
    }

    // ‚îÄ‚îÄ Charts ‚îÄ‚îÄ
    function renderCharts(orders, dailySnap) {
        const chartDefaults = {
            color: 'rgba(255,255,255,0.5)',
            borderColor: 'rgba(255,255,255,0.1)',
        };
        Chart.defaults.color = '#555';

        // Revenue by month
        const months = ['Sty','Lut','Mar','Kwi','Maj','Cze','Lip','Sie','Wrz','Pa≈∫','Lis','Gru'];
        const revenueByMonth = Array(12).fill(0);
        orders.forEach(o => {
            if (o.createdAt?.toDate) {
                const m = o.createdAt.toDate().getMonth();
                revenueByMonth[m] += (o.price || 0);
            }
        });
        const currentMonth = new Date().getMonth();
        const last6months = [];
        const last6labels = [];
        for (let i = 5; i >= 0; i--) {
            const idx = (currentMonth - i + 12) % 12;
            last6months.push(revenueByMonth[idx]);
            last6labels.push(months[idx]);
        }

        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: last6labels,
                datasets: [{
                    label: 'Przych√≥d (z≈Ç)',
                    data: last6months,
                    borderColor: 'rgba(255,255,255,0.8)',
                    backgroundColor: 'rgba(255,255,255,0.04)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#fff',
                    pointRadius: 4,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555' } },
                    y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555', callback: v => v + ' z≈Ç' } }
                }
            }
        });

        // Orders last 7 days
        const last7 = [];
        const last7labels = [];
        for (let i = 6; i >= 0; i--) {
            const d = new Date(); d.setDate(d.getDate() - i);
            const key = d.toISOString().split('T')[0];
            last7labels.push(d.toLocaleDateString('pl', { weekday: 'short' }));
            const count = orders.filter(o => {
                if (!o.createdAt?.toDate) return false;
                return o.createdAt.toDate().toISOString().split('T')[0] === key;
            }).length;
            last7.push(count);
        }

        new Chart(document.getElementById('ordersChart'), {
            type: 'bar',
            data: {
                labels: last7labels,
                datasets: [{
                    data: last7,
                    backgroundColor: 'rgba(255,255,255,0.12)',
                    borderColor: 'rgba(255,255,255,0.3)',
                    borderWidth: 1,
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555' } },
                    y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555', stepSize: 1 } }
                }
            }
        });

        // Pie chart
        const robuxCount = orders.filter(o => o.game === 'robux').length;
        const gtaCount   = orders.filter(o => o.game === 'gta').length;
        const other      = orders.length - robuxCount - gtaCount;
        new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: {
                labels: ['Robux', 'GTA$', 'Inne'],
                datasets: [{
                    data: [robuxCount, gtaCount, other],
                    backgroundColor: ['rgba(168,85,247,0.7)', 'rgba(59,130,246,0.7)', 'rgba(255,255,255,0.15)'],
                    borderColor: ['rgba(168,85,247,1)', 'rgba(59,130,246,1)', 'rgba(255,255,255,0.3)'],
                    borderWidth: 1,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#555', font: { size: 11 }, padding: 12 } }
                }
            }
        });

        // Visits chart
        const dailyData = dailySnap.exists() ? dailySnap.data() : {};
        const last14 = [], last14labels = [];
        for (let i = 13; i >= 0; i--) {
            const d = new Date(); d.setDate(d.getDate() - i);
            const key = d.toISOString().split('T')[0];
            last14.push(dailyData[key] || 0);
            last14labels.push(d.toLocaleDateString('pl', { day: 'numeric', month: 'short' }));
        }
        new Chart(document.getElementById('visitsChart'), {
            type: 'line',
            data: {
                labels: last14labels,
                datasets: [{
                    label: 'Wej≈õcia',
                    data: last14,
                    borderColor: 'rgba(59,130,246,0.8)',
                    backgroundColor: 'rgba(59,130,246,0.08)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#3b82f6',
                    pointRadius: 3,
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555' } },
                    y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#555', stepSize: 1 } }
                }
            }
        });
    }

    // ‚îÄ‚îÄ Orders table ‚îÄ‚îÄ
    function renderOrdersTable(orders, users) {
        document.getElementById('orders-count-badge').textContent = orders.length + ' zam√≥wie≈Ñ';
        const body = document.getElementById('orders-table-body');
        if (orders.length === 0) {
            body.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#444;padding:40px;">Brak zam√≥wie≈Ñ</td></tr>';
            return;
        }
        const sorted = [...orders].sort((a,b) => {
            const ta = a.createdAt?.toDate?.() || 0;
            const tb = b.createdAt?.toDate?.() || 0;
            return tb - ta;
        });
        body.innerHTML = sorted.map(o => {
            const user = users.find(u => u.id === o.userId) || {};
            const nick = user.nick || user.displayName || o.clientNick || '‚Äî';
            const email = user.email || o.clientEmail || '‚Äî';
            const initials = nick.substring(0,2).toUpperCase();
            const date = o.createdAt?.toDate ? o.createdAt.toDate().toLocaleDateString('pl') : (o.date || '‚Äî');
            const price = typeof o.price === 'number' ? o.price.toFixed(2).replace('.',',') + ' z≈Ç' : '‚Äî';
            const isDelivered = o.status === 'delivered';
            const dotClass = o.game === 'robux' ? 'dot-robux' : 'dot-gta';
            const gpLink = o.gamepassLink
                ? `<a href="${o.gamepassLink}" target="_blank" style="color:#a855f7;font-size:12px;font-weight:700;text-decoration:none;padding:4px 10px;background:rgba(168,85,247,0.1);border:1px solid rgba(168,85,247,0.3);border-radius:8px;">üéÆ Otw√≥rz</a>`
                : '<span style="color:#333;font-size:11px;">brak</span>';
            const completeBtn = isDelivered
                ? `<span class="badge badge-delivered">Dostarczono</span>`
                : `<span class="badge badge-pending" style="cursor:pointer;" onclick="markDelivered('${o.id}', '${o.userId || ''}', '${o.clientNick || ''}', '${o.title || ''}', '${o.game || ''}', ${o.price || 0})">W realizacji ‚Äî kliknij ‚úì</span>`;
            return `<tr>
                <td><div class="user-cell"><div class="user-avatar-sm">${initials}</div><div><div style="font-weight:700;font-size:13px;">${nick}</div><div style="font-size:11px;color:#555;">${email}</div></div></div></td>
                <td><div class="product-cell"><div class="product-dot ${dotClass}"></div>${o.title || '‚Äî'}</div></td>
                <td style="font-weight:700;">${price}</td>
                <td style="color:#666;">${date}</td>
                <td>${gpLink}</td>
                <td>${completeBtn}</td>
            </tr>`;
        }).join('');
    }

    // ‚îÄ‚îÄ Customers table ‚îÄ‚îÄ
    function renderCustomersTable(users, orders) {
        document.getElementById('customers-count-badge').textContent = users.length + ' klient√≥w';
        const body = document.getElementById('customers-table-body');
        if (users.length === 0) {
            body.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#444;padding:40px;">Brak klient√≥w</td></tr>';
            return;
        }
        body.innerHTML = users.map(u => {
            const userOrders = orders.filter(o => o.userId === u.id);
            const spent = userOrders.reduce((s,o) => s+(o.price||0),0);
            const initials = (u.nick || u.email || '?').substring(0,2).toUpperCase();
            return `<tr>
                <td><div class="user-cell"><div class="user-avatar-sm">${initials}</div><div style="font-weight:700;font-size:13px;">${u.nick || u.displayName || '‚Äî'}</div></div></td>
                <td style="color:#666;font-size:12px;">${u.email || '‚Äî'}</td>
                <td style="color:#888;">${u.nick || '‚Äî'}</td>
                <td style="font-weight:700;">${userOrders.length}</td>
                <td style="font-weight:700;color:#22c55e;">${spent.toFixed(2).replace('.',',')} z≈Ç</td>
            </tr>`;
        }).join('');
    }

    // ‚îÄ‚îÄ Visits page ‚îÄ‚îÄ
    function renderVisits(analyticsSnap, dailySnap) {
        const total = analyticsSnap.exists() ? (analyticsSnap.data().total || 0) : 0;
        const dailyData = dailySnap.exists() ? dailySnap.data() : {};
        const today = new Date().toISOString().split('T')[0];
        const todayCount = dailyData[today] || 0;
        let weekCount = 0;
        for (let i = 0; i < 7; i++) {
            const d = new Date(); d.setDate(d.getDate() - i);
            weekCount += dailyData[d.toISOString().split('T')[0]] || 0;
        }
        document.getElementById('visit-total').textContent = total.toLocaleString('pl');
        document.getElementById('visit-today').textContent = todayCount;
        document.getElementById('visit-today-date').textContent = new Date().toLocaleDateString('pl');
        document.getElementById('visit-week').textContent = weekCount;
        document.getElementById('stat-visits').textContent = total.toLocaleString('pl');
        document.getElementById('stat-visits-sub').textContent = '≈ÇƒÖcznie';
    }

    // ‚îÄ‚îÄ Top products ‚îÄ‚îÄ
    function renderTopProducts(orders) {
        const counts = {};
        orders.forEach(o => { counts[o.title] = (counts[o.title]||0) + 1; });
        const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5);
        const max = sorted[0]?.[1] || 1;
        const el = document.getElementById('topProductsList');
        if (sorted.length === 0) {
            el.innerHTML = '<div style="color:#444;font-size:12px;text-align:center;padding:20px;">Brak danych</div>';
            return;
        }
        el.innerHTML = sorted.map(([name, count], i) => `
            <div class="product-row">
                <div class="product-rank">#${i+1}</div>
                <div class="product-info">
                    <div class="product-name-sm">${name}</div>
                    <div class="product-bar-wrap">
                        <div class="product-bar" style="width:${(count/max*100).toFixed(0)}%"></div>
                    </div>
                </div>
                <div class="product-count">${count}x</div>
            </div>
        `).join('');
    }

    // ‚îÄ‚îÄ Add order ‚îÄ‚îÄ
    document.getElementById('addOrderBtn').onclick = async () => {
        const email   = document.getElementById('fo-email').value.trim();
        const nick    = document.getElementById('fo-nick').value.trim();
        const productVal = document.getElementById('fo-product').value;
        const status  = document.getElementById('fo-status').value;
        const note    = document.getElementById('fo-note').value.trim();
        const btn     = document.getElementById('addOrderBtn');

        if (!email || !nick) { alert('Wype≈Çnij email i nick klienta.'); return; }

        const [title, game, priceStr] = productVal.split('|');
        const price = parseFloat(priceStr);

        btn.textContent = 'ZAPISYWANIE...';
        btn.disabled = true;

        try {
            await addDoc(collection(db, 'orders'), {
                clientEmail: email,
                clientNick: nick,
                title, game, price, status, note,
                createdAt: serverTimestamp(),
                createdByOwner: true
            });
            document.getElementById('form-success').style.display = 'block';
            document.getElementById('fo-email').value = '';
            document.getElementById('fo-nick').value = '';
            document.getElementById('fo-note').value = '';
            setTimeout(() => document.getElementById('form-success').style.display='none', 3000);
        } catch(e) {
            alert('B≈ÇƒÖd: ' + e.message);
        }

        btn.textContent = 'DODAJ ZAM√ìWIENIE';
        btn.disabled = false;
    };

    // ‚îÄ‚îÄ Mark order as delivered ‚îÄ‚îÄ
    window.markDelivered = async function(orderId, userId, clientNick, title, game, price) {
        if (!confirm(`Oznaczyƒá "${title}" jako dostarczone?`)) return;
        try {
            // Update order status in orders collection
            await updateDoc(doc(db, 'orders', orderId), { status: 'delivered' });

            // Also update in user's zamowienia array if userId exists
            if (userId) {
                const userRef = doc(db, 'users', userId);
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    const userData = userSnap.data();
                    const zamowienia = (userData.zamowienia || []).map(z => {
                        if (z.title === title && z.status === 'pending') {
                            return { ...z, status: 'delivered' };
                        }
                        return z;
                    });
                    await updateDoc(userRef, { zamowienia });
                }
            }

            alert('Zam√≥wienie oznaczone jako dostarczone!');
            location.reload();
        } catch(e) {
            alert('B≈ÇƒÖd: ' + e.message);
        }
    };
</script>
</body>
</html>
